{% extends "layout.html" %}

{% block title %}Audio Analysis - TuneForge{% endblock %}

{% block content %}
<div class="audio-analysis-container">
    <div class="page-header">
        <h1>üéµ Audio Analysis Management</h1>
        <p>Manage and monitor audio feature extraction for your music library</p>
    </div>

    <!-- Analysis Overview -->
    <div class="analysis-overview">
        <div class="overview-card">
            <h3>üìä Library Overview</h3>
            <div class="stats-grid">
                <div class="stat-item">
                    <span class="stat-number">{{ progress.total_tracks }}</span>
                    <span class="stat-label">Total Tracks</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number">{{ progress.analyzed_tracks }}</span>
                    <span class="stat-label">Analyzed</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number">{{ progress.pending_tracks }}</span>
                    <span class="stat-label">Pending</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number">{{ progress.error_tracks }}</span>
                    <span class="stat-label">Errors</span>
                </div>
            </div>
            <div class="progress-bar-container">
                <div class="progress-bar">
                    <div id="page-progress-fill" class="progress-fill" style="width: {{ progress.progress_percentage }}%"></div>
                </div>
                <span id="page-progress-text" class="progress-text">{{ progress.progress_percentage }}% Complete</span>
            </div>
        </div>
    </div>

    <!-- Control Panel -->
    <div class="control-panel">
        <div class="control-card">
            <h3>üéÆ Control Panel</h3>
            <div class="control-options">
                <div class="control-group">
                    <label for="max-workers">Max Workers:</label>
                    <select id="max-workers">
                        <option value="1">1 Worker</option>
                        <option value="2">2 Workers</option>
                        <option value="3" selected>3 Workers</option>
                        <option value="4">4 Workers</option>
                        <option value="5">5 Workers</option>
                    </select>
                </div>
                <div class="control-group">
                    <label for="batch-size">Batch Size:</label>
                    <select id="batch-size">
                        <option value="50">50 tracks</option>
                        <option value="100" selected>100 tracks</option>
                        <option value="200">200 tracks</option>
                        <option value="500">500 tracks</option>
                    </select>
                </div>
                <div class="control-group">
                    <label for="process-limit">Process Limit:</label>
                    <select id="process-limit">
                        <option value="">All pending tracks</option>
                        <option value="100">100 tracks</option>
                        <option value="500">500 tracks</option>
                        <option value="1000">1000 tracks</option>
                        <option value="5000">5000 tracks</option>
                    </select>
                </div>
            </div>
            <div class="control-buttons">
                <button id="start-analysis" class="btn btn-primary">
                    <span class="btn-icon">üöÄ</span>
                    Start Analysis
                </button>
                <button id="stop-analysis" class="btn btn-danger" style="display: none;">
                    <span class="btn-icon">‚èπÔ∏è</span>
                    Stop Analysis
                </button>
                <button id="refresh-status" class="btn btn-secondary">
                    <span class="btn-icon">üîÑ</span>
                    Refresh Status
                </button>
            </div>
        </div>
    </div>

    <!-- Live Status -->
    <div class="live-status">
        <div class="status-card">
            <h3>üì° Live Status</h3>
            <div id="live-status-content">
                <div class="status-item">
                    <span class="status-label">Status:</span>
                    <span id="analysis-status" class="status-value">Stopped</span>
                </div>
                <div class="status-item">
                    <span class="status-label">Workers:</span>
                    <span id="active-workers" class="status-value">0</span>
                </div>
                <div class="status-item">
                    <span class="status-label">Queue Size:</span>
                    <span id="queue-size" class="status-value">0</span>
                </div>
                <div class="status-item">
                    <span class="status-label">Processing:</span>
                    <span id="processing-jobs" class="status-value">0</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Progress Details -->
    <div class="progress-details">
        <div class="progress-card">
            <h3>üìà Progress Details</h3>
            <div id="progress-details-content">
                <div class="progress-grid">
                    <div class="progress-item">
                        <span class="progress-label">Total Jobs:</span>
                        <span id="total-jobs" class="progress-value">0</span>
                    </div>
                    <div class="progress-item">
                        <span class="progress-label">Completed:</span>
                        <span id="completed-jobs" class="progress-value">0</span>
                    </div>
                    <div class="progress-item">
                        <span class="progress-label">Failed:</span>
                        <span id="failed-jobs" class="progress-value">0</span>
                    </div>
                    <div class="progress-item">
                        <span class="progress-label">Retrying:</span>
                        <span id="retrying-jobs" class="progress-value">0</span>
                    </div>
                </div>
                <div class="progress-metrics">
                    <div class="metric-item">
                        <span class="metric-label">Success Rate:</span>
                        <span id="success-rate" class="metric-value">0%</span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label">Average Time:</span>
                        <span id="avg-time" class="metric-value">0s</span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label">ETA:</span>
                        <span id="eta" class="metric-value">Calculating...</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Recent Activity -->
    <div class="recent-activity">
        <div class="activity-card">
            <h3>üìã Recent Activity</h3>
            <div id="recent-activity-content">
                <div class="activity-item">
                    <span class="activity-time">--:--</span>
                    <span class="activity-message">No recent activity</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Maintenance -->
    <div class="maintenance">
        <div class="maintenance-card">
            <h3>üîß Maintenance</h3>
            <div class="maintenance-options">
                <div class="maintenance-group">
                    <label for="cleanup-days">Clean up data older than:</label>
                    <select id="cleanup-days">
                        <option value="7">7 days</option>
                        <option value="30" selected>30 days</option>
                        <option value="90">90 days</option>
                        <option value="180">180 days</option>
                    </select>
                </div>
                <button id="cleanup-data" class="btn btn-warning">
                    <span class="btn-icon">üßπ</span>
                    Clean Up Old Data
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Status Messages -->
<div id="status-messages"></div>

<script>
// Audio Analysis Management JavaScript
class AudioAnalysisManager {
    constructor() {
        this.isRunning = false;
        this.statusInterval = null;
        this.progressInterval = null;
        this.lastKnownProgress = null;
        this.lastStatusCheck = 0;
        this.cachedProgress = null;  // Cache the last good progress value
        this.init();
    }

    init() {
        this.bindEvents();
        this.loadInitialStatus();
        this.startStatusPolling();
    }

    bindEvents() {
        // Control buttons
        document.getElementById('start-analysis').addEventListener('click', () => this.startAnalysis());
        document.getElementById('stop-analysis').addEventListener('click', () => this.stopAnalysis());
        document.getElementById('refresh-status').addEventListener('click', () => this.refreshStatus());
        document.getElementById('cleanup-data').addEventListener('click', () => this.cleanupData());
    }

    async startAnalysis() {
        try {
            const maxWorkers = parseInt(document.getElementById('max-workers').value);
            const batchSize = parseInt(document.getElementById('batch-size').value);
            const limit = document.getElementById('process-limit').value || null;

            // Add to global status manager immediately (same pattern as playlist generator)
            if (window.globalStatusManager) {
                // Check if we should allow adding audio analysis
                if (!this.shouldAllowAudioAnalysis()) {
                    console.log('[AudioAnalysis] Preventing audio analysis from being added (recently stopped)');
                    return;
                }
                
                // Clear cache when starting new analysis
                this.cachedProgress = null;
                
                window.globalStatusManager.addAudioAnalysis();
                
                // Initialize with cached progress if available
                if (this.cachedProgress && this.cachedProgress.progress_percentage > 0) {
                    window.globalStatusManager.updateAudioAnalysis({
                        progress: this.cachedProgress.progress_percentage,
                        processedTracks: this.cachedProgress.analyzed_tracks || 0,
                        totalTracks: this.cachedProgress.total_tracks || 0,
                        currentStatus: 'Resuming...',
                        queueSize: this.cachedProgress.pending_tracks || 0,
                        failedTracks: this.cachedProgress.error_tracks || 0
                    });
                }
            } else {
                console.warn('Global status manager not available to add audio analysis immediately');
            }

            const response = await fetch('/api/audio-analysis/start', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ max_workers: maxWorkers, batch_size: batchSize, limit: limit })
            });

            const result = await response.json();

            if (result.success) {
                this.showMessage(result.message, 'success');
                this.isRunning = true;
                this.updateControlButtons();
                this.startProgressPolling();
            } else {
                this.showMessage(result.error, 'error');
                
                // Remove from global status manager on error
                if (window.globalStatusManager) {
                    window.globalStatusManager.removeAudioAnalysis();
                }
            }
        } catch (error) {
            this.showMessage(`Error starting analysis: ${error.message}`, 'error');
            
            // Remove from global status manager on error
            if (window.globalStatusManager) {
                window.globalStatusManager.removeAudioAnalysis();
            }
        }
    }

    async stopAnalysis() {
        try {
            // Update global status manager first to show "Stopping..."
            if (window.globalStatusManager && window.globalStatusManager.activeAudioAnalysis) {
                window.globalStatusManager.updateAudioAnalysis({
                    status: 'stopping',
                    currentStatus: 'Stopping analysis...'
                });
            }
            
            const response = await fetch('/api/audio-analysis/stop', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' }
            });

            const result = await response.json();

            if (result.success) {
                this.showMessage(result.message, 'success');
                this.isRunning = false;
                this.updateControlButtons();
                
                // Stop ALL polling immediately
                this.stopProgressPolling();
                this.stopStatusPolling();
                
                // Set timestamp to prevent re-adding
                this.lastStatusCheck = Date.now();
                
                // Reset cached progress when stopping
                this.cachedProgress = null;
                
                // Remove from global status manager immediately
                if (window.globalStatusManager) {
                    window.globalStatusManager.removeAudioAnalysis();
                }
                
                // Double-check server status after a short delay to ensure indicator is removed
                setTimeout(async () => {
                    try {
                        const statusResponse = await fetch('/api/audio-analysis/status');
                        const status = await statusResponse.json();
                        
                        if (status.status === 'stopped' || status.status === 'completed') {
                            console.log(`[AudioAnalysis] Confirmed analysis ${status.status}, ensuring indicator is removed`);
                            // Force remove if still present
                            if (window.globalStatusManager && window.globalStatusManager.activeAudioAnalysis) {
                                window.globalStatusManager.removeAudioAnalysis();
                            }
                        }
                    } catch (error) {
                        console.error('Error checking final status:', error);
                    }
                }, 1000);
                
                // Update status to reflect stopped state
                await this.updateStatus();
                await this.updateProgress();
            } else {
                this.showMessage(result.error, 'error');
                
                // Reset global status manager on error
                if (window.globalStatusManager && window.globalStatusManager.activeAudioAnalysis) {
                    window.globalStatusManager.updateAudioAnalysis({
                        status: 'running',
                        currentStatus: 'Processing...'
                    });
                }
            }
        } catch (error) {
            this.showMessage(`Error stopping analysis: ${error.message}`, 'error');
            
            // Reset global status manager on error
            if (window.globalStatusManager && window.globalStatusManager.activeAudioAnalysis) {
                window.globalStatusManager.updateAudioAnalysis({
                    status: 'running',
                    currentStatus: 'Processing...'
                });
            }
        }
    }

    async refreshStatus() {
        await this.updateStatus();
        await this.updateProgress();
    }

    async cleanupData() {
        try {
            const daysOld = parseInt(document.getElementById('cleanup-days').value);
            
            const response = await fetch('/api/audio-analysis/cleanup', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ days_old: daysOld })
            });

            const result = await response.json();

            if (result.success) {
                this.showMessage(result.message, 'success');
                // Refresh progress after cleanup
                setTimeout(() => this.updateProgress(), 1000);
            } else {
                this.showMessage(result.error, 'error');
            }
        } catch (error) {
            this.showMessage(`Error cleaning up data: ${error.message}`, 'error');
        }
    }

    async loadInitialStatus() {
        await this.updateStatus();
        await this.updateProgress();
    }

    async updateStatus() {
        try {
            const response = await fetch('/api/audio-analysis/status');
            const status = await response.json();

            // Update status display
            document.getElementById('analysis-status').textContent = status.status;
            document.getElementById('active-workers').textContent = status.workers || 0;
            document.getElementById('queue-size').textContent = status.queue_size || 0;
            document.getElementById('processing-jobs').textContent = status.processing_jobs || 0;

            // Update running state
            this.isRunning = status.status === 'running';
            this.updateControlButtons();

        } catch (error) {
            console.error('Error updating status:', error);
        }
    }

    async updateProgress() {
        try {
            const response = await fetch('/api/audio-analysis/progress');
            const result = await response.json();

            if (result.success) {
                const progress = result.progress;
                
                // Update progress values
                document.getElementById('total-jobs').textContent = progress.total_tracks || 0;
                document.getElementById('completed-jobs').textContent = progress.analyzed_tracks || 0;
                document.getElementById('failed-jobs').textContent = progress.error_tracks || 0;
                document.getElementById('retrying-jobs').textContent = '0'; // Not available in DB progress
                document.getElementById('success-rate').textContent = `${progress.progress_percentage || 0}%`;
                
                // Update main progress bar (scoped to this page only)
                const progressFill = document.getElementById('page-progress-fill');
                if (progressFill) {
                    progressFill.style.width = `${progress.progress_percentage || 0}%`;
                }
                
                // Update progress text (scoped to this page only)
                const progressText = document.getElementById('page-progress-text');
                if (progressText) {
                    progressText.textContent = `${progress.progress_percentage || 0}% Complete`;
                }
                
                // Only update global status manager on the first progress update or if we have valid data
                if (window.globalStatusManager && window.globalStatusManager.activeAudioAnalysis) {
                    const currentProgress = window.globalStatusManager.activeAudioAnalysis.progress;
                    
                    // Use cached progress if available, otherwise use current progress
                    const progressToUse = this.cachedProgress || progress;
                    
                    // Only update if this is the first update (progress === 0) or if we have valid progress data
                    if (currentProgress === 0 || (progressToUse.progress_percentage !== undefined && progressToUse.progress_percentage > 0)) {
                        window.globalStatusManager.updateAudioAnalysis({
                            progress: progressToUse.progress_percentage || currentProgress, // Use current progress if new data is invalid
                            processedTracks: progressToUse.analyzed_tracks || 0,
                            totalTracks: progressToUse.total_tracks || 0,
                            currentStatus: 'Processing...',
                            queueSize: progressToUse.pending_tracks || 0,
                            failedTracks: progressToUse.error_tracks || 0
                        });
                    }
                }
            }
        } catch (error) {
            console.error('Error updating progress:', error);
        }
    }

    startStatusPolling() {
        this.statusInterval = setInterval(async () => {
            // Only continue polling if analysis is still running
            if (!this.isRunning) {
                this.stopStatusPolling();
                return;
            }
            
            // Check if analysis has actually stopped on the server
            try {
                const response = await fetch('/api/audio-analysis/status');
                const status = await response.json();
                
                if (status.status === 'stopped' || status.status === 'completed') {
                    console.log(`[AudioAnalysis] Analysis status is ${status.status}, stopping all polling and removing indicator`);
                    this.isRunning = false;
                    this.stopStatusPolling();
                    this.stopProgressPolling();
                    
                    // Remove from global status manager
                    if (window.globalStatusManager && window.globalStatusManager.activeAudioAnalysis) {
                        window.globalStatusManager.removeAudioAnalysis();
                    }
                    
                    // Update UI
                    this.updateControlButtons();
                    this.showMessage(`Analysis ${status.status}`, 'info');
                    
                    // Prevent any further status checks for a short time
                    this.lastStatusCheck = Date.now();
                } else {
                    this.updateStatus();
                }
            } catch (error) {
                console.error('Error checking analysis status:', error);
                this.updateStatus();
            }
        }, 5000);
    }

    startProgressPolling() {
        this.progressInterval = setInterval(async () => {
            // Only continue polling if analysis is still running
            if (!this.isRunning) {
                this.stopProgressPolling();
                return;
            }
            
            // Get progress data first before updating anything
            const progressData = await this.getProgressData();
            
            // Use safe update to prevent flashing
            if (this.safeUpdateProgress(progressData)) {
                // Update the page progress display
                await this.updateProgress();
                
                // Update global status manager with the cached progress data
                if (window.globalStatusManager && window.globalStatusManager.activeAudioAnalysis) {
                    window.globalStatusManager.updateAudioAnalysis({
                        progress: this.cachedProgress.progress_percentage,
                        processedTracks: this.cachedProgress.analyzed_tracks || 0,
                        totalTracks: this.cachedProgress.total_tracks || 0,
                        currentStatus: 'Processing...',
                        queueSize: this.cachedProgress.pending_tracks || 0,
                        failedTracks: this.cachedProgress.error_tracks || 0
                    });
                }
            }
        }, 2000);
    }
    
    async getProgressData() {
        try {
            const response = await fetch('/api/audio-analysis/progress');
            const result = await response.json();
            
            if (result.success && result.progress) {
                // Store the last known good progress
                this.lastKnownProgress = result.progress;
                return result.progress;
            }
            return null;
        } catch (error) {
            console.error('Error getting progress data:', error);
            return null;
        }
    }
    
    getLastKnownProgress() {
        return this.lastKnownProgress || null;
    }
    
    shouldAllowAudioAnalysis() {
        // Prevent re-adding audio analysis if it was recently stopped (within 10 seconds)
        const timeSinceLastCheck = Date.now() - this.lastStatusCheck;
        return timeSinceLastCheck > 10000; // 10 seconds
    }
    
    safeUpdateProgress(progressData) {
        // Only update if we have valid progress data
        if (!progressData || progressData.progress_percentage === undefined) {
            return false;
        }
        
        const newProgress = progressData.progress_percentage;
        
        // If this pie is the first update, cache it
        if (this.cachedProgress === null) {
            this.cachedProgress = progressData;
            return true;
        }
        
        // Only update if the new progress is better (higher) than cached
        if (newProgress > this.cachedProgress.progress_percentage) {
            this.cachedProgress = progressData;
            return true;
        }
        
        // If new progress is lower, don't update (prevents flashing to 0%)
        return false;
    }

    stopProgressPolling() {
        if (this.progressInterval) {
            clearInterval(this.progressInterval);
            this.progressInterval = null;
        }
    }
    
    stopStatusPolling() {
        if (this.statusInterval) {
            clearInterval(this.statusInterval);
            this.statusInterval = null;
        }
    }

    updateControlButtons() {
        const startBtn = document.getElementById('start-analysis');
        const stopBtn = document.getElementById('stop-analysis');

        if (this.isRunning) {
            startBtn.style.display = 'none';
            stopBtn.style.display = 'inline-block';
        } else {
            startBtn.style.display = 'inline-block';
            stopBtn.style.display = 'none';
        }
    }

    showMessage(message, type = 'info') {
        const messagesContainer = document.getElementById('status-messages');
        const messageElement = document.createElement('div');
        messageElement.className = `status-message status-${type}`;
        messageElement.textContent = message;
        
        messagesContainer.appendChild(messageElement);
        
        // Auto-remove after 5 seconds
        setTimeout(() => {
            if (messageElement.parentNode) {
                messageElement.parentNode.removeChild(messageElement);
            }
        }, 5000);
    }
    
    cleanup() {
        // Stop all polling when cleaning up
        this.stopProgressPolling();
        this.stopStatusPolling();
        
        // Remove from global status manager if still active
        if (window.globalStatusManager && window.globalStatusManager.activeAudioAnalysis) {
            window.globalStatusManager.removeAudioAnalysis();
        }
    }
}

// Initialize when page loads
document.addEventListener('DOMContentLoaded', () => {
    window.audioAnalysisManager = new AudioAnalysisManager();
});

// Clean up when page is unloaded
window.addEventListener('beforeunload', () => {
    if (window.audioAnalysisManager) {
        window.audioAnalysisManager.cleanup();
    }
});
</script>

<style>
.audio-analysis-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
}

.page-header {
    text-align: center;
    margin-bottom: 30px;
}

.page-header h1 {
    color: #6a8a5e;
    margin-bottom: 10px;
}

.page-header p {
    color: #888;
    font-size: 16px;
}

.analysis-overview, .control-panel, .live-status, .progress-details, .recent-activity, .maintenance {
    margin-bottom: 30px;
}

.overview-card, .control-card, .status-card, .progress-card, .activity-card, .maintenance-card {
    background: #2a2a2a;
    border-radius: 12px;
    padding: 24px;
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
    border: 1px solid #444;
}

.overview-card h3, .control-card h3, .status-card h3, .progress-card h3, .activity-card h3, .maintenance-card h3 {
    color: #6a8a5e;
    margin-bottom: 20px;
    font-size: 18px;
}

.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
    gap: 20px;
    margin-bottom: 20px;
}

.stat-item {
    text-align: center;
}

.stat-number {
    display: block;
    font-size: 28px;
    font-weight: bold;
    color: #6a8a5e;
}

.stat-label {
    display: block;
    font-size: 12px;
    color: #888;
    text-transform: uppercase;
    margin-top: 5px;
}

.progress-bar-container {
    margin-top: 20px;
}

.progress-bar {
    height: 8px;
    background: #444;
    border-radius: 4px;
    overflow: hidden;
    margin-bottom: 10px;
}

.progress-fill {
    height: 100%;
    background: linear-gradient(90deg, #6a8a5e, #8bc34a);
    transition: width 0.3s ease;
}

.progress-text {
    font-size: 14px;
    color: #888;
}

/* Audio Analysis Progress Indicator Styles */
.progress-indicator.audio-analysis {
    border-left: 4px solid #9C27B0;
    background: linear-gradient(135deg, #f8f9ff 0%, #f0f2ff 100%);
}

.progress-indicator.audio-analysis .progress-header {
    color: #9C27B0;
}

.progress-indicator.audio-analysis .progress-fill {
    background: linear-gradient(90deg, #9C27B0, #7B1FA2);
}

.control-options {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin-bottom: 20px;
}

.control-group {
    display: flex;
    flex-direction: column;
}

.control-group label {
    font-size: 14px;
    color: #ccc;
    margin-bottom: 8px;
}

.control-group select {
    padding: 8px 12px;
    border: 1px solid #555;
    border-radius: 6px;
    background: #333;
    color: #fff;
    font-size: 14px;
}

.control-buttons {
    display: flex;
    gap: 15px;
    flex-wrap: wrap;
}

.btn {
    padding: 12px 24px;
    border: none;
    border-radius: 8px;
    font-size: 14px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s ease;
    display: inline-flex;
    align-items: center;
    gap: 8px;
}

.btn-primary {
    background: #6a8a5e;
    color: white;
}

.btn-primary:hover {
    background: #5a7a4e;
}

.btn-danger {
    background: #dc3545;
    color: white;
}

.btn-danger:hover {
    background: #c82333;
}

.btn-secondary {
    background: #6c757d;
    color: white;
}

.btn-secondary:hover {
    background: #5a6268;
}

.btn-warning {
    background: #ffc107;
    color: #212529;
}

.btn-warning:hover {
    background: #e0a800;
}

.status-item, .progress-item, .metric-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 0;
    border-bottom: 1px solid #444;
}

.status-item:last-child, .progress-item:last-child, .metric-item:last-child {
    border-bottom: none;
}

.status-label, .progress-label, .metric-label {
    font-size: 14px;
    color: #ccc;
}

.status-value, .progress-value, .metric-value {
    font-size: 14px;
    color: #6a8a5e;
    font-weight: 500;
}

.progress-grid, .progress-metrics {
    margin-bottom: 20px;
}

.activity-item {
    display: flex;
    gap: 15px;
    padding: 10px 0;
    border-bottom: 1px solid #444;
}

.activity-item:last-child {
    border-bottom: none;
}

.activity-time {
    font-size: 12px;
    color: #888;
    min-width: 60px;
}

.activity-message {
    font-size: 14px;
    color: #ccc;
}

.maintenance-options {
    display: flex;
    flex-direction: column;
    gap: 20px;
}

.maintenance-group {
    display: flex;
    flex-direction: column;
}

.maintenance-group label {
    font-size: 14px;
    color: #ccc;
    margin-bottom: 8px;
}

.maintenance-group select {
    padding: 8px 12px;
    border: 1px solid #555;
    border-radius: 6px;
    background: #333;
    color: #fff;
    font-size: 14px;
    max-width: 200px;
}

#status-messages {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 1000;
}

.status-message {
    padding: 12px 20px;
    margin-bottom: 10px;
    border-radius: 8px;
    color: white;
    font-size: 14px;
    animation: slideIn 0.3s ease;
}

.status-success {
    background: #28a745;
}

.status-error {
    background: #dc3545;
}

.status-info {
    background: #17a2b8;
}

@keyframes slideIn {
    from {
        transform: translateX(100%);
        opacity: 0;
    }
    to {
        transform: translateX(0);
        opacity: 1;
    }
}

@media (max-width: 768px) {
    .audio-analysis-container {
        padding: 15px;
    }
    
    .control-options {
        grid-template-columns: 1fr;
    }
    
    .control-buttons {
        flex-direction: column;
    }
    
    .stats-grid {
        grid-template-columns: repeat(2, 1fr);
    }
}
</style>
{% endblock %}
